<!DOCTYPE html>
<html>
<head>
    <title>KityFormula公式编辑器</title>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">

    <link rel="stylesheet" href="assets/styles/page.css">
    <link rel="stylesheet" href="assets/styles/base.css">
    <link rel="stylesheet" href="assets/styles/scrollbar.css">
    <link rel="stylesheet" href="assets/theme/default/fui.min.css">
    <link rel="stylesheet" href="assets/theme/default/fui.ext.css">

    <script src="../config/ui.conf.js"></script>
    <script src="/math/static/js/jquery-1.11.1.min.js"></script>
    <script src="../lib/jhtmls.min.js"></script>
    <script src="../lib/fui.all.js"></script>
    <script src="../lib/kitygraph.all.min.js"></script>
    <script src="../lib/kity-formula-render.all.js"></script>
    <script src="../lib/kity-formula-parser.all.js"></script>
    <script src="../lib/kityformula-editor.all.js"></script>
    <script>
        jQuery( function ($) {
            var factory = kf.EditorFactory.create( $( "#eidotr" )[ 0 ], {
                render: {
                    fontsize: 40
                },
                resource: {
                    path: "../resource/"
                }
            } );

            factory.ready( function ( KFEditor ) {
                // this指向KFEditor
                var source = "\\placeholder";

                if (top.cur_widget) {
                    source = top.cur_widget.data.math;
                    source = source.slice(2, source.length - 2);
                }

                /*
                if ( top.KF_EDITOR.getRebuild ) {

                    var rebuildSource = top.KF_EDITOR.getRebuild();

                    if ( rebuildSource ) {
                        source = rebuildSource;
                    }

                }
                */

                top.kfEditor = this;

                console.log('first:' + source);
                this.execCommand( "render", source );
                window.setTimeout(function () {
                    top.kfEditor.execCommand( "focus" );
                }, 100);
                //this.execCommand( "focus" );


                /*
                // 设置打开dialog时设置公式的句柄
                top.KF_EDITOR.setOpenHandler( function ( source ) {

                    console.log('openhandler:' + source);
                    KFEditor.execCommand( "render", source );
                    window.setTimeout( function () {
                        KFEditor.execCommand( "focus" );
                    }, 0 );

                } );
                */
            });

        } );
    </script>
</head>
<body>
    <div id="eidotr" class="kf-editor" style="width: 778px; height: 498px;"></div>
</body>
</html>
